[
{
    "name": "list",
    "method":"GET",
    "property" : "public",
    "comment":"查询仓库列表",

    "request": [
        {"name":"offset", "type":"int", "must":true, "min":0, "comment":"偏移"},
        {"name":"num", "type":"int",  "must":true, "min":1, "comment":"返回行数"}
    ],

    "process" : [
        {
            "name" : "list_warehouses",
            "type" : "rdb",
            "db": "common",
            "sqls" : [{
                "name" : "list",
                "metas" : "each",
                "multi" : true,
                "merge" : false,
                "sql":"select id,name,addr,cmt,createAt from warehouse
                        order by id LIMIT @{num} OFFSET @{offset}"
            }]
        }
    ]
},
{
    "name": "add",
    "method":"POST",
    "property" : "private",
    "tokenChecker":"USER",
    "aclChecker":"RBAC",
    "feature":"admin",
    "comment":"增加仓库",

    "request": [
        {"name":"name", "type":"string", "must":true, "min":1, "comment":"仓库名称"},
        {"name":"addr", "type":"string", "must":true, "min":1, "comment":"仓库地址"},
        {"name":"cmt", "type":"string", "must":false, "default":"", "comment":"描述"}
    ],

    "process" : [
        {
            "name" : "add_warehouse",
            "type" : "rdb",
            "db": "common",
            "sqls" : [
                "insert into warehouse(id,name,addr,cmt,createAt) values(
                @{SEQUENCE|i,whid},'@{name}','@{addr}','@{cmt}',@{NOW|unit60000})"
            ]
        }
    ]
},
{
    "name": "update",
    "method":"POST",
    "property" : "private",
    "tokenChecker":"USER",
    "aclChecker":"RBAC",
    "feature":"admin",
    "comment":"修改仓库信息",

    "request": [
        {"name":"id", "type":"int", "must":true, "min":0, "comment":"仓库ID"},
        {"name":"name", "type":"string", "must":true, "min":1, "comment":"仓库名称"},
        {"name":"addr", "type":"string", "must":true, "min":1, "comment":"仓库地址"},
        {"name":"cmt", "type":"string", "must":false, "default":"", "comment":"描述"}
    ],

    "process" : [
        {
            "name" : "update_warehouse",
            "type" : "rdb",
            "db": "common",
            "sqls" : [
                "update warehouse set
                    name='@{name}',
                    addr='@{addr}',
                    cmt='@{cmt}' where id=@{id}"
            ]
        }
    ]
},
{
    "name": "remove",
    "method":"DELETE",
    "property" : "private",
    "tokenChecker":"USER",
    "aclChecker":"RBAC",
    "feature":"admin",
    "comment":"删除仓库，只有仓库中无存货的情况下才可以删除",

    "request": [
        {"name":"id", "type":"int", "must":true, "min":0, "comment":"仓库ID"}
    ],

    "process" : [
        {
            "name" : "judge_wh_exists",
            "db" : "common",
            "type" : "dataexists",
            "expect" : false, //如果存在，则返回EXISTS，否则返回OK
            "numSeg" : "whNum",
            "convert" : {"code":2000, "to":3003, "info":"warehouse not empty"},
            "sqls":[{
                "name":"get_wh_num",
                "metas":"each",
                "merge":true,
                "multi":false,
                "sql":"select count(*) whNum from inventory where warehouse=@{id}"
            }]
        },
        {
            "name" : "delete_warehouse",
            "type" : "rdb",
            "db": "common",
            "sqls" : [
                "delete from warehouse where id=@{id}"
            ]
        }
    ]
}
]